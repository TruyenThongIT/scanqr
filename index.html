<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="UTF-8">
 <meta name="google-signin-client_id"
 content="765091097213-lpim0bumlhrd2cit0vqija382bdca070.apps.googleusercontent.com">
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta http-equiv="X-UA-Compatible" content="ie=edge">
 <script src='//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js'></script>
 <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js'></script>;
 <script src='https://rawgit.com/schmich/instascan-builds/master/instascan.min.js'></script>;
 <title>QR Code</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>



</head>

<body>
  <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="menu.html">Trang chủ</a>  <!-- code ctsv -->
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                     <!-- <li><a href="http://ctsv.stu.edu.vn/user/edit_user/1605">Tài khoản</a></li> -->
                     <li><a href="#">Tài khoản</a></li>
        <!-- <li><a href="http://ctsv.stu.edu.vn/attendance/qr">Mã QR</a></li> -->

                <li class="dropdown"  >
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Câu hỏi trắc nghiệm <span class="caret"></span></a>
                <ul class="dropdown-menu">
                         <li><a href="#">Danh sách đề thi </a></li>
                         <li><a href="#">Tạo đề thi</a></li>
               
                </ul>
              </li>
            
        <!-- <li><a href="http://ctsv.stu.edu.vn/result">Kết quả thi</a></li> --> 
        <li><a href="quetqr.html">Quét mã</a></li>
      
          <li><a href="http://ctsv.stu.edu.vn/user/logout">Đăng xuất</a></li>
          <!-- <li><a href="#">Đăng xuất</a></li> -->
              <!--
        <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                 d
                </ul>
              </li>
        -->
        
            </ul>
             
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>
 <!-- <table border="1" width="900" height="500">
 <tr>
 <td>

 </td>
 <td verticalAlign="top">
 <div id="container"></div>
 </td>
 </tr>
 </table> -->


 <table border="1" width="600" height="500" style="margin: 50px auto 50px;">
 <tr height="50">
 <td>
 <p style="font-weight: bold; font-size: 20px;" align="center">Máy Quét</p>
 </td>
 <td>
 <p style="font-weight: bold; font-size: 20px;" align="center">Mã QR</p>
 </td>
 </tr>
 <tr>
 <td style="vertical-align:top;"><video id="preview" style="height:520px;"></video></td>
 <td align="center" style="vertical-align: top;">

 <div id="container"></div>
 <br>
 
 <button id="btnGenerateQR">Generate QR</button>

 </td>
 </tr>
 </table>
</body>
<script type="text/javascript">
 
 let scanner = new Instascan.Scanner(
 {
    video: document.getElementById('preview')  
 });

 scanner.addListener('scan', function (content) {
  
   console.log(content);
   // alert(content);
   // var data = $('form#test-form').serialize();
   $.ajax({
     type: 'GET',
     url: 'https://script.google.com/macros/s/AKfycbynvBLCU_13O-tKQ6XX_56BwhoXE3JnnLHfNTdHY4SLQa8TbWpA/exec',
     dataType: 'json',
     crossDomain: true,
     data: content,
     success: function (data) {
     if (data == 'false' ) {
       alert('thêm thất bại')  ;
     } else {
       alert('Đã thêm dữ liệu vào Form')  ;
     }
   }
   });
  
  if(content){
    scanner.stop();
  }
 });

 $("#btnGenerateQR").click(function(){
   Instascan.Camera.getCameras().then(cameras => {
  
   if (cameras.length > 0) {
      scanner.start(cameras[1]);
   } else {
       console.error("Không tìm thấy Camera !" ) ;
   }
 });
 })



</script>

</html>
